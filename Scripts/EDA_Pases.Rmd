---
title: "EDA"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

paquetes <- list(
  "Tidyverse"     = list("dplyr", "tidyr", "tidyselect", "stringr", "ggplot2"),
  "API" = list("worldfootballR")
)

lapply(
  as.list(
    c(paquetes, recursive = TRUE, use.names = FALSE)),
  function(x) {
    library(x, character.only = TRUE, verbose = FALSE)
  })

rm(list = c("paquetes"))

```

```{r estadisticas, echo=FALSE}

pases_jugadores <- fb_big5_advanced_season_stats(
  season_end_year = c(2018:2021),
  stat_type       = "passing",
  team_or_player  = "player"
)
```
 
```{r estadisticas, echo=FALSE} 

# Estadistica descriptiva de los pases totales

pases_jugadores <- pases_jugadores %>% 
  filter(Mins_Per_90 > 9)

media_pases_totales <- round(
  mean(pases_jugadores$Cmp_Total, trim = 0.1, na.rm = TRUE),
  digits = 2
  ) %>% 
  print()

mediana_pases_totales <- round(median(pases_jugadores$Cmp_Total, na.rm = TRUE), digits = 2) %>%
  print() 

desvio_pases_totales <- round(sd(pases_jugadores$Cmp_Total, na.rm = TRUE), digits = 2) %>% 
  print()

plot_normal <- qqnorm(pases_jugadores$Cmp_Total, pch = 1, frame = FALSE) 

pases_jugadores %>%
 ggplot(aes(x = Cmp_Total)) +
  geom_histogram(aes(y = ..density..), binwidth = .5, colour = "black", fill = "white") +
  geom_density(alpha = .2, fill = "#FF6666") +
  geom_vline(xintercept = media_pases_totales, color = "red") 
  

``` 
Mirando el grafico de densidad de la cantidad de pases totales por jugador
se puede ver como la distribuicion de los pases totales de los jugadores acumula
gran parte de sus datos al inicio. Luego se puede ver como se "achata" la campana.

Esto se podria a llegar a intepretar de la siguiente forma: la mayoria de los jugadores
tienen un rendimiento poco destacable. Si bien la media de la cantidad de pases totales
es 723.57 la mediana es del 681. Esto indica que mas de la mitad de los jugadores
se encuentran por debajo del promedio. 

Por otro lado, al tener un desvio estandar de 442.82 se puede observar como hay multiples jugadores que rinden excesivamente por encima del promedio. Como los datos son pases 
totales, tiene sentido que haya un desvio estandar relativamente alto ya que no se
espera que un aruqero haga la misma cantidad de pases que un mediocampista. 
 

```{r pases cortos, echo=FALSE}

# Calculo la proporcion de los pases totales que son pases cortos

pases_cortos <- pases_jugadores %>% 
  filter(Mins_Per_90 > 10) %>% 
  mutate(
    percent_short = scales::percent(Att_Short / TotDist_Total, accuracy = 0.01)
  ) %>% 
  select(Player, Squad, percent_short, TotDist_Total, Cmp_Short, Pos)
```

```{r estadisticas, echo=FALSE}

# Grafico la relacion entre la distancia total de pases y la proporcion de pases cortos sobre el total

 pases_cortos %>%
   ggplot(mapping = aes(x = TotDist_Total, y = percent_short, size = Cmp_Short, color = Pos)) +
   geom_point() +
   geom_smooth(method = lm, se = FALSE) +
   labs(title = "Proporcion de pases cortos segun distancia total") +
   xlab("Distancia total de pases") +
   ylab("Porcentaje de pases cortos del total") +
   theme(panel.background = element_rect(fill = 'grey', colour = 'black'))
```

```{r estadisticas, echo=FALSE}

# Mismo procedimiento que con los pasos cortos pero con pases largos

pases_largos <- pases_jugadores %>% 
  mutate(
    percent_long = Att_Long / TotDist_Total
  ) %>% 
  select(percent_long, TotDist_Total, Cmp_Long, Team)

```

```{r estadisticas, echo=FALSE}

# Grafico la relacion entre la distancia total de pases y la proporcion de pases largos sobre el total

pases_largos %>%
  ggplot(mapping = aes(x = TotDist_Total, y = percent_long, size = Cmp_Long, color = Team)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  labs(title = "Proporcion de pases largos segun distancia total") +
  xlab("Distancia total de pases") +
  ylab("Porcentaje de pases largos del total") +
  theme(panel.background = element_rect(fill = 'grey', colour = 'black'))
```


```{r estadisticas, echo=FALSE}

# Calcular el desvio estandar y luego calcular que % de cambio del prom. representa
# ese desvio. 

Cmp_Pases_Standard_Deviation <- pases_jugadores %>% 
  mutate(
    Cmp_Total_SD         = sd(Cmp_Total),
    Cmp_Total_AV         = mean(Cmp_Total),
    Cmp_Total_Change_AV  = scales::percent(Cmp_Total_SD / Cmp_Total_AV),
    Cmp_Short_SD         = sd(Cmp_Short),
    Cmp_Short_AV         = mean(Cmp_Short),
    Cmp_Short_Change_AV  = scales::percent(Cmp_Short_SD / Cmp_Short_AV),
    Cmp_Medium_SD        = sd(Cmp_Medium),
    Cmp_Medium_AV        = mean(Cmp_Medium),
    Cmp_Medium_Change_AV = scales::percent(Cmp_Medium_SD / Cmp_Medium_AV),
    Cmp_Long_SD          = sd(Cmp_Long),
    Cmp_Long_AV          = mean(Cmp_Long),
    Cmp_Long_Change_AV   = scales::percent(Cmp_Long_SD / Cmp_Long_AV)
  ) %>% 
  select(
    Cmp_Short_Change_AV, 
    Cmp_Medium_Change_AV, 
    Cmp_Long_Change_AV,
    Cmp_Total_Change_AV
  ) %>% 
  slice(1)




```